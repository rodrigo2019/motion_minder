[gcode_shell_command motion_minder]
command: ~/printer_data/config/motion_minder/motion_minder.sh
timeout: 600.0
verbose: True

[respond]

[gcode_macro MOTION_MINDER]
gcode:
    {% set query = params.QUERY|default(False) %}
    {% set init_km = params.INIT_KM|default(False) %}
    {% set process_history = params.PROCESS_HISTORY|default(False) %}
    {% set process_gcode = params.PROCESS_GCODE|default(False) %}
    {% if query %}
        RUN_SHELL_COMMAND CMD=motion_minder PARAMS="query"
    {% elif init_km %}
        RUN_SHELL_COMMAND CMD=motion_minder PARAMS="init_km {init_km}"
    {% elif process_history %}
        RESPOND MSG="Its experimental, it can take a while, please wait..."
        RUN_SHELL_COMMAND CMD=motion_minder PARAMS="process_history"
    {% elif process_gcode %}
        RUN_SHELL_COMMAND CMD=motion_minder PARAMS="process_gcode {process_gcode}"
    {% endif %}